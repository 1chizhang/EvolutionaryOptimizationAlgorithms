# 蚁群算法（ant colony optimization）

<img src="C:\Users\22179\Desktop\1.png" alt="1" style="zoom:25%;" />

## 简介

  蚁群算法是一种群智能算法，它是由一群无智能或有轻微智能的个体（Agent）通过相互协作而表现出智能行为，从而为求解复杂问题提供了一个新的可能性。

## 原理

  假设蚁群中的所有蚂蚁的数量为m，所有城市之间的信息素用矩阵pheromone表示，最短路径bestLength，最佳路径bestTour。每只蚂蚁有自己的内存，内存中用一个禁忌表（Tabu）来储存蚂蚁访问过的城市，表示其在以后的搜索中将不能访问这些城市；还有用另外一个允许访问的城市表（Allowed）来存储它还可以访问的城市；另外还用一个矩阵（Delta）来存储它在一个循环（或者迭代）中给所经过的路径释放的信息素；还有另外一些数据，例如一些控制参数(α，β，ρ，Q)，该蚂蚁行走玩全程的总成本或距离（tourLength），等等。假定算法总共运行MAX_GEN次，运行时间为t。

  蚁群算法计算过程如下：

（1）初始化。

（2）为每只蚂蚁选择下一个节点。

（3）更新信息素矩阵。

（4）检查终止条件

> 如果达到最大代数MAX_GEN，算法终止，转到第（5）步；否则，重新初始化所有的蚂蚁的Delt矩阵所有元素初始化为0，Tabu表清空，Allowed表中加入所有的城市节点。随机选择它们的起始位置（也可以人工指定）。在Tabu中加入起始节点，Allowed中去掉该起始节点，重复执行（2），（3）,(4)步。

（5）输出最优值

## 代码

```python
https://github.com/Spicy-curry/EvolutionaryOptimizationAlgorithms/blob/main/aco
```

## 参数的设置

  1.蚁群数目m：影响着算法的搜索能力和计算量。蚂蚁数目过多时，每轮选代的计算量大、且被搜索过的路径上信息素变化比较平均，此时算法的全局随机搜索能力得到增强，但收敛速度减慢；蚁群数目过少时，算法的探索能力变差，容易出现早熟现象。特别是当问题规模很大时，算法的全局寻优能力会变得十分糟糕。

  2.信息素权重α 与启发式信息权重β：决定算法搜索的导向，影响算法的搜索能力。α越小，最邻近城市被选中的概率越大，蚂蚁越注重"眼前利益”，α=0时，算法等同于随机贪婪算法；β越小，蚂蚁越倾向于根据信息素浓度确定路径，算法收敛越快，β=0时,构建出的最优路径与实际目标有着较大差异，算法的性能比较情糕。

  3.信息素挥发因子ρ ：影响蚂蚁个体之问相互影响的强弱，关系到算法的全局搜索能力和收敛速度。ρ较大时,信息素挥发速率大，那些从未被蚂蚁选择过的边上的信息索急剧减小到接近0，降低算法的全局探索能力；ρ较小时，算法具有较高的全局搜索能力，但是由于各个路径的信息素浓度差距拉大较慢，算法收敛速度较慢。

  4.初始信息素量γ 0：决定算法在初始化阶段的探索能力，影响算法的收做速度。γ 0太小，未被蚂蚁选择过的边上信息素太少，蚂蚁很快就全部集中在一 条局部最优的路径上，算法容易早熟；γ 0太大，信息素对搜索方向的引导能力增长得十分缓慢，算法收慢。

  5.终止条件：决定算法运行何时结束由其体的应用和问题本身的确定。将最大循环数设定为500、1000、 5000，或者最大的函数评估次数，等等；也可以使用算法求解得到一个可接受的解作为终止条件；或者是当算法在很长一段迭代中没有得到任何改善时，可以终止算法。

# 习题

  道路网络上有n个点，已知其中任意两点间的直接距离d(i, j)；这些点包括n’个车站和n-n’个充电站；一辆电动车从一个车站出发，要经过其它所有车站并回到出发点；车辆初始时满电，满电最大行驶距离100km，充满电时间1小时，行驶速度25km/小时。请设计求最短行驶路径的算法。

## 改进的蚁群算法（MACO: Modified Ant Colony Optimization）

### 模型建立

#### 模型假定

  经典 TSP 模型中，由于存在“所有节点恰好访问一次”的假定，而充电设施有时并不需要被访问，因此难以直接使用经典模型来求解考虑充电设施的电动车辆旅行商问题。。同时，该条假定也使得任何情况下均不会形成子回路，因此经典模型下所有的子回路均需被消除。而在考虑充电站重入的情况下，电动车通过充电站与其他车站相连形成的子回路却是合理的，然而车站之间形成的子回路依然不被允许，需要被消除。因此，引入充电站节点、区分子回路的类型并松弛部分子回路约束，即子回路约束的变形，就是该模型的主要措施。

#### 约束条件

  （1） 节点约束: 车站节点被且只被访问一次，而充电站节点的访问次数不被限制; 

  （2）路程约束: 电动汽车从起始车站出发，连续经过车站和充电站节点，最终返回起始车站; 

  （3） 电量约束: 电动汽车只有在离开车站和充电站时电量被充满，同时剩余电量必须保证其能够到达剩余节点。

#### 解决多次访问

  在基本模型中给每个充电站增加“虚拟复制点”( 如: 预估最多只需重入 一次，则令 M'= M ∪ M，由 M'代替M) 。这种处理方法的优点比较明显，即对于模型本身改动不大，同时也能部分满足优化的需求; 但存在两个比较明显的缺点: ①需要预估重入次数上限，否则过少可能丢失最优解，过多使问题规模太大［3］; ②产生多解问题，如: 假设 A'为充电设施 A 的一个“虚拟复制点”，那么路径 0 － 1 － A － 2 － A' － 0 与0 － 1 － A' － 2 － A － 0 实际是同一个解，但模型中却被区分为两个解。

### 算法设计

#### 改进的原则

  ①经典蚁群算法使用单一标准( 一般为目标函数)来评判路径，而本模型由于需要考虑车辆里程限制，路径除了长短的区别，还有可行和不可行的区分，需要协调这两种评判标准; 

  ②经典蚁群算法中，所有路径点被且只被访问一次，而本模型所考虑的充电站，在电量足够的情况下并不需要出现在路径中，而当重入发生时又需要在路径中重复出现，因此需要增加充电设施选择和重复的策略。

#### 策略

##### 可行性策略

  对于第一个问题的解决，本模型引进适应度的概念，其取值需要先判定路径的可行与否，以此来得到分泌信息素的浓度。由于电动汽车的电量只能在充电站得到补充，因此可以将路径按照充电站进行分段，并依次判断各条子路径是否符合续航里程的限制。如果得到的一条路径为 0 － 1 － 2 － A － 3 － 4 － B － 5 － A － 6 － 0 ( 其中 A、B 代表充电设施，0 为起始车站) ，则将该条路径分为0 － 1 － 2 － A、A － 3 － 4 － B、 B － 5 － A、A － 6 － 0 四条子路径，计算这些子路径长度，如果均符合里程限制，则该路径必然可行，否则为不可行。

  在判断出路径可行与否的基础之上，适应度和信息素浓度的取值为:适应度 = 路径总长度 如果路径可行；M 如果路径不可行；其中 M 为一个远大于路径总长度的数。

  信息素浓度 = C /适应度，其中 C 为一个正的常数。

  当路径不可行时，可假设路径总长度极大，从而信息素浓度极小，此次蚁群得到的路径对结果基本无影响。

##### 充电站决策

（1) 合适位置的确定:当电动车剩余电量越少，它需要通过充电站的概率就越大。在经过每个车站节点时产生一个随机数rand∈［0，1］，通过比较电池容量 Q 的 rand 倍来确定最优位置，即: 当 $Q_r$>=Q × rand 时，认为这是一个去充电站的“合适位置”。显然消耗的电量$Q_r$越 大，越容易出现“合适位置”。

（2）采用“距离”作为对充电设施选择的标准。当根据之前的方法认为路径点 i 之后需要插入充电设施时，先根据信息素浓度得到后续节点 j，然后计算所有充电站到前后节点的距离之和，选取一个距离最小的充电设施。

### 伪代码

```
算法MACO描述

输入: 车站和充电站节点集合，节点间距离$d_(ij)$，电池容量 Q，电池消耗速率 r

输出: 最优路径和最优值

1: 初始化信息素矩阵

2: Do 

3: 初始化蚁群路径 route，所有蚂蚁回到原位

4: For 每只蚂蚁

5: 重置电量消耗记录变量 $Q_r$ = 0 

6: While 候选车站集合不为空

7: 按信息素浓度概率选择一个节点 $P_j$

8: 产生随机数 rand∈［0，1］ 

9: if $Q_r$>=Q × rand 

10: 取 route 的尾节点 $P_i$

11: 计算充电站与  $P_i$和 $P_j$距离之和

12: 选取距离最小的充电站

13: 将充电站连接到 route 的末尾，并重置 $Q_r$ = 0 

14: End if 

15: 将 $P_j$连接到 route 的末尾，从候选顾客集中删除  $P_j$，更新 $Q_r$

16: End while 

17: End For 

18: 信息素挥发

19: 按照每只蚂蚁的适应度为路径分泌信息素

20: 更新最优结果

21: Until 迭代终止条件满足

22: Ｒeturn 最优路径和最优值
```

  